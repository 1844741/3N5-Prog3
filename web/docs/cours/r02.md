import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import PowerShellWindow from '@site/src/components/PowerShellWindow';

# Rencontre 2 - Objets et pipeline

:::note R√©sum√© de la s√©ance

<Tabs>

<TabItem value="deroulement" label="üë®‚Äçüè´ D√©roulement du cours">

1. Rappel du cours pr√©c√©dent
1. Correction des exercices
1. Exemples de commandes utiles
1. Objets
1. Pipeline
1. Variables

</TabItem>

<TabItem value="exercices" label="üíª Exercices √† compl√©ter">

Les exercices suivants se trouvent dans votre section personnelle du bloc-notes du cours, sous l'onglet *Exercices*:
- Exercice 02: Objets et pipeline

</TabItem>

<TabItem value="ressources" label="üìö Ressources √† consulter">

La pr√©sentation PowerPoint est sur le Teams du cours, sous le canal G√©n√©ral > Fichiers > Supports de cours.

</TabItem>

</Tabs>

:::

PowerShell est un langage **orient√© objet** reposant sur le cadre logiciel _.NET Framework_. De ce fait, chaque commande (cmdlet) retourne un ou plusieurs objets. Cette particularit√© diff√®re des commandes externes et des autres langages de shell, qui retournent du texte

Les objets sont beaucoup plus facile √† interpr√©ter par des algorithmes, car on peut extraire l'information qu'on souhaite sans proc√©der √† des manipulations de cha√Ænes de caract√®res. Ils nous donnent l'opportunit√© de les manipuler √† notre guise, en les passant d'une commande √† l'autre dans ce qu'on appelle le pipeline. Or, les humains ont plus de facilit√© √† lire du texte que des objets. Donc √† la fin de la cha√Æne de commandes, l'objet r√©sultant est automatiquement converti en texte afin d'√™tre lu par l'utilisateur.

Cette s√©ance de cours porte principalement sur l'utilisation des objets qui r√©sultent des diff√©rentes commandes PowerShell ainsi que le cha√Ænage de plusieurs commandes dans le _pipeline_.


## Objets

Les commandes PowerShell retournent un ou plusieurs objets. Un objet est une structure de donn√©es, un √©l√©ment logique d'information d'une structure d√©finie par une classe (ou type). Il est compos√© de plusieurs membres, soit des propri√©t√©s (ou m√©thodes), qui repr√©sentent de l'information d√©crivant l'objet, et des m√©thodes (ou fonctions) qui posent une action sur cet objet.

### Conna√Ætre les membres d'un objet

La commande `Get-Member` permet d'obtenir la liste des propri√©t√©s et des m√©thodes offertes par cet objet. Dans le cas d'une collection d'objets, elle analyse le type d'objet dans la collection.

![image](./assets/r02_01a.png)

On peut sp√©cifier le type de membre pour une recherche plus cibl√©e.

![image](./assets/r02_01b.png)


### Obtenir une propri√©t√©

Par exemple, la commande `Get-Item` retourne l'information sur un fichier ou un dossier. Le r√©sultat de cette commande est un objet qui d√©crit le fichier ou le dossier correspondant.

![image](./assets/r02_01c.png)

Si l'objet repr√©sente un fichier, il poss√®dera une propri√©t√© `.Length` qui repr√©sente sa taille, en octets. Pour acc√©der √† un membre d'un objet, on utilise le caract√®re point. Il y a plusieurs mani√®res d'identifier l'objet, soit avec des parenth√®ses, soit en le passant dans une variable.

![image](./assets/r02_01d.png)


### Explorer les propri√©t√©s d'un objet

Pour explorer un objet, il est √©galement utile de demander √† lister toutes ses propri√©t√©s.

![image](./assets/r02_01e.png)

Il est ainsi plus facile de trouver des propri√©t√©s int√©ressantes.


### Appeler une m√©thode

L'appel d'une m√©thode se fait de la m√™me mani√®re que pour une propri√©t√©, sauf que la m√©thode peut accepter des param√®tres. Comme une m√©thode n'est pas une commande PowerShell, les param√®tres n'ob√©issent pas aux m√™me r√®gles: ils ne sont pas nomm√©s, et doivent √™tre sp√©cifi√©s en parenth√®ses.

![image](./assets/r02_01f.png)

Si la m√©thode qu'on appelle n'a pas de param√®tre, il faut √©crire les parenth√®ses quand m√™me.

![image](./assets/r02_01g.png)


### Conna√Ætre le type d'un objet

Une mani√®re de conna√Ætre le type d'un objet est d'appeler sa m√©thode GetType(). Cette m√©thode existe dans tous les types d'objets, et retourne un objet qui d√©crit le type de cet objet.

![image](./assets/r02_01h.png)

Par exemple, la commande Get-Item peut retourner des fichiers et des dossiers, qui sont des structures tr√®s diff√©rentes. Selon l'√©l√©ment que l'on tente d'obtenir, le type de l'objet r√©sultant sera diff√©rent.

![image](./assets/r02_01i.png)

Si la commande retourne plusieurs objets, alors le type de l'objet retourn√© sera un array, c'est-√†-dire un objet qui contient plusieurs objets. On les identifie avec des crochets [ ] √† la fin de leur type.

![image](./assets/r02_01j.png)


## Le _pipeline_

Le _pipeline_ est le m√©canisme par lequel l'information circule dans une session PowerShell. Il permet de cha√Æner des commandes afin que l'objet sortant d'une commande entre dans la prochaine pour y √™tre trait√©. Le caract√®re pour cha√Æner les commande est la barre verticale `|` (appel√©e "_pipe_" ou "_tube_").

Une commande produisant un objet en sortie (ou un objet d√©pos√© directement dans le _pipeline_) sera donc pass√© en entr√©e √† la commande suivante, qui le passera dans un de ses param√®tres, le traitera et produira un autre objet de type diff√©rent, qui pourra √™tre pass√© √† la prochaine commande, et ainsi de suite.

![image](./assets/r02_02a.png)

√Ä la fin du _pipeline_, l'objet qui s'y trouve "tombe" dans la console (le host), o√π il sera automatiquement converti en texte selon plusieurs r√®gles r√©gies √† la fois par la configuration de PowerShell et par la nature de cet objet.

![image](./assets/r02_02b.png)

On peut √©viter √† l'objet de tomber dans la console en le "pipant" dans une autre commande (habituellement, avec le verbe Out-), ou bien en l'affectant √† une variable.

![image](./assets/r02_02c.png)

Si on souhaite se d√©barrasser de l'objet r√©sultant, il suffit de terminer la cha√Æne de _pipeline_ par la commande Out-Null, qui d√©signe simplement une sortie vers rien du tout.

![image](./assets/r02_02d.png)


## Les variables

Les variables en PowerShell sont identifi√©es avec le pr√©fixe `$`. Par exemple, la variable _Foo_ s'√©crit `$Foo` dans le code PowerShell. Le nom de la variable est _Foo_, et le caract√®re `$` indique √† PowerShell qu'il s'agit d'une variable.

Une variable contient un objet. L'op√©ration consistant √† mettre un objet dans une variable se nomme une affectation, et on la r√©alise √† l'aide de l'op√©rateur d'affectation, `=`. Cet op√©rateur r√©cup√®re l'objet r√©sultant √† la fin du _pipeline_ afin de le stocker dans la variable, plut√¥t que de le laisser tomber dans la console.

Pour obtenir le contenu d'une variable, on utilise simplement son nom avec le caract√®re `$`. Cela a pour effet d'envoyer son contenu dans le _pipeline_. On peut aussi utiliser cette variable pour passer un objet dans un param√®tre.

![image](./assets/r02_03a.png)

Une variable contient un objet, donc on peut l'utiliser pour acc√©der √† toutes les m√©thodes et tous les attributs offerts par cet objet.

![image](./assets/r02_03b.png)

On peut conna√Ætre la liste de toutes les variables d√©clar√©es avec la commande `Get-Variable`.

![image](./assets/r02_03c.png)


### Variables pr√©d√©finies

Certaines variables sont pr√©d√©finies par PowerShell.

| Variable | Description |
| -- | -- |
| `$true` | Repr√©sente la valeur bool√©enne vraie |
| `$false` | Repr√©sente la valeur bool√©enne fausse |
| `$null` | Repr√©sente la valeur nulle |
| `$PID` | Le num√©ro d'identification du processus courant |
| `$PWD` | Repr√©sente le r√©pertoire courant |
| `$args` | Contient un tableau des arguments pass√©s √† l'appel d'une fonction ou d'un script |
| `$error` | Liste des erreurs lors de la session |
| `$PSVersionTable` | Tableau des versions de PowerShell |
| `$Host` | Objet qui permet de modifier l'interface PowerShell |
| `$Home` | Le chemin du r√©pertoire de l'utilisateur (typiquement `C:\Users\nomdutilisateur`) |
| `$PSHome` | Le chemin dans lequel PowerShell est install√© |
| `$PSCulture` | La culture de la session PowerShell (`fr-CA`, `en-US`, etc.) |
| `$_` ou `$PSItem` | Valeur courante dans le _pipeline_ |
| ... | |

### Variables d'environnement

Le syst√®me d'exploitation offre √† tous les processus un ensemble de variables g√©r√©es par le syst√®me et qui procurent de l'information sur l'environnement d'ex√©cution. 

Voici quelques variables d'environnement (mais il y en a plusieurs autres).

| Variable (PoSH) | Description |
| -- | -- |
| `$env:COMPUTERNAME` | Le nom d'h√¥te de l'ordinateur |
| `$env:USERNAME` | Le nom de l'utilisateur |
| `$env:USERDOMAIN` | Le nom du domaine de l'utilisateur courant (format NetBIOS) |
| `$env:USERDNSDOMAIN` | Le nom du domaine de l'utilisateur courant (format FQDN) |
| `$env:LOGONSERVER` | Le nom du contr√¥leur de domaine ayant authentifi√© l'utilisateur lors de son logon |
| `$env:UserProfile` | Le chemin vers le profil de l'utilisateur (typiquement C:\Users\nomdutilisateur) |
| `$env:APPDATA` | Chemin vers le r√©pertoire AppData/Roaming de l'utilisateur courant |
| `$env:LocalAppData` | Chemin vers le r√©pertoire AppData/Local de l'utilisateur courant |
| `$env:HOMEDRIVE` | Le lecteur sur lequel est situ√© le profil de l'utilisateur |
| `$env:HOMEPATH` | Le chemin relatif du profil utilisateur sur le lecteur HOMEDRIVE |
| `$env:TEMP` | Le chemin vers le r√©pertoire temporaire de l'utilisateur (m√™me que TMP) |
| `$env:TMP` | Le chemin vers le r√©pertoire temporaire de l'utilisateur (m√™me que TEMP) |
| `$env:ALLUSERSPROFILE` | Le chemin vers le profil utilisateur commun √† tous les utilisateurs (programdata) |
| `$env:ProgramData` | Le chemin du r√©pertoire qui contiennent les configurations du syst√®me |
| `$env:ProgramFiles` | Le chemin vers le r√©pertoire contenant les fichiers de programme |
| `$env:{ProgramFiles (x86)}` | Le chemin vers le r√©pertoire des fichiers de programme 32-bits (WoW64) |
| `$env:Path` | La liste des chemins qui contiennent des commandes ex√©cutables |
| `$env:PATHEXT` | La liste des extensions √† consid√©rer comme ex√©cutables |
| `$env:PUBLIC` | Le chemin vers le r√©pertoire public (partag√© par tous les profils) |
| `$env:NUMBER_OF_PROCESSORS` | Le nombre de processeurs logiques install√©s dans le syst√®me |
| `$env:PROCESSOR_ARCHITECTURE` | L'architecture du processeur (x86, amd64, ia64, arm64, etc.) |
| `$env:ComSpec` | Le chemin vers l'interpr√©teur de commande par d√©faut |
| `$env:OneDrive` | Le chemin vers le r√©pertoire de synchronisation de OneDrive |
| `$env:OneDriveCommercial` | Le chemin vers le r√©pertoire de synchronisation de OneDrive For Business |
| `$env:SystemDrive` | Le lecteur sur lequel Windows est install√© (typiquement C:) |
| `$env:SystemRoot` | Le chemin vers le r√©pertoire o√π Windows est install√© (typiquement C:\Windows) |
| `$env:PSModulePath` | La liste des chemins qui contiennent des modules PowerShell |

Dans l'interpr√©teur de commande classique (cmd), et √† plusieurs autres endroits du syst√®me (comme dans le shell graphique, le registre, etc.), les variables d'environnement sont accessibles en les entourant de deux symboles `%`.

![image](./assets/r02_03d.png)

![image](./assets/r02_03e.png)

La commande Set permet d'obtenir la liste des variables d'environnement.

![image](./assets/r02_03f.png)

Sous PowerShell, la syntaxe est diff√©rente. On utilise le pr√©fixe `$env:` pour y acc√©der.

![image](./assets/r02_03g.png)

Pour obtenir la liste, on fait un `Get-ChildItem` sur le lecteur `env:`, qui contient toutes les variables d'environnement du processus.

![image](./assets/r02_03h.png)

:::caution

Les variables d'environnement sont rattach√©es √† un processus particulier, et chaque processus cr√©√© h√©rite des variables d'environnement du processus parent. Ainsi, si on fait des modification √† une variable d'environnement, celle-ci ne sera modifi√©e que dans ce processus et pas les autres. De plus, le changement sera d√©truit apr√®s la fin du processus, lorsque la fen√™tre PowerShell est ferm√©e. Il est possible de modifier une variable d'environnement de mani√®re permanente, mais nous verrons cela dans une s√©ance ult√©rieure.

:::






